<!DOCTYPE html>
<html class="h-100" xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:replace="fragments/head :: header" />
    <title>FilmAdmin</title>
</head>

<body class="d-flex flex-column h-100">
    <header th:replace="fragments/nav.html :: nav"></header>

    <main class="flex-shrink-0">
        <div class="container">
            <h1 class="mt-5">Mi perfil</h1>
            <div class="d-flex justify-content-between">
                <div class="d-flex flex-column">
                    <h2 class="mt-5 mb-5">Información de <span th:text="${user.username}">Paco</span></h2>
                    <div class="d-flex align-items-center">
                        <img width="240px" height="326px" th:src="@{/user/{id}/pic(id=${session.u.id})}">
                        <form class="d-flex flex-column ms-5">
                            <input type="text" class="form-control mb-2" placeholder="Nombre" name="nombre">
                            <input type="text" class="form-control mb-2" placeholder="Apellidos" name="apellidos">
                            <input type="email" class="form-control mb-2" id="email" placeholder="correo@filmadmin.es" name="email">
                            <input type="date" class="form-control mb-2" name="fecha">
                            <input class="form-control" type="file" id="userimg" name="imagen" accept="image/*">
                            <button type="submit" class="btn btn-dark mt-3">Editar Información</button>
                        </form>
                    </div>
                </div>
                <div class="d-flex flex-column align-items-center panelder">
                    <h2 class="mt-5">Mis entradas</h2>
                    <div class="table-responsive tablaentradas mt-3 ms-5">
                        <table class="table align-middle">
                            <thead></thead>
                            <tbody>
                                <tr th:if="${#lists.isEmpty(entradas)}">
                                   <td th:if="${#lists.isEmpty(entradas)}">Aún no has comprado ninguna entrada </td>
                                </tr>
                                <tr th:each="entrada : ${entradas}" th:unless="${#lists.isEmpty(entradas)}">
                                    <td th:text="${#lists.size(entrada.asientos) + ' asientos'}">10 asientos</td>
                                    <td><a th:href="@{/peliculas/{id}(id=${entrada.sesion.pelicula.id})}" th:text="${entrada.sesion.pelicula.titulo}" class="text-dark bold">El buen patrón</a></td>
                                    <td th:text="${#temporals.format(entrada.sesion.dia_hora, 'dd/MM/yy')}">01/03/22</td>
                                    <td th:if="${entrada.sesion.dia_hora.minute &lt; 10}" th:text="${entrada.sesion.dia_hora.hour + ':0' + entrada.sesion.dia_hora.minute}">21:00</td>
                                    <td th:unless="${entrada.sesion.dia_hora.minute &lt; 10}" th:text="${entrada.sesion.dia_hora.hour + ':' + entrada.sesion.dia_hora.minute}">21:00</td>
                                    <td th:text="${entrada.sesion.cine.nombre}">La Gavia</td>
                                    <td th:text="${entrada.sesion.sala.nombre}">Sala 3</td>
                                    <td><a th:href="@{/entradas/{id}(id=${entrada.id})}" ><button type="button" class="btn btn-dark btn-sm">Ver entrada</button></a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <h2 class="mt-5">Cambiar contraseña</h2>
                    <form class="d-flex flex-column align-items-center">
                        <div class="d-flex mt-3">
                            <input type="text" class="form-control mb-2" placeholder="Nueva contraseña" name="password">
                            <input type="text" class="form-control ms-2 mb-2" id="passwordconfirm" placeholder="Repetir contraseña" name="passwordconfirm">   
                        </div>
                        
                        <button type="submit" class="btn btn-dark mt-3">Cambiar contraseña</button>
                    </form>
                </div>
            </div>
            
            
            <!-- para enviar mensajes; algo feo 
            <div class="py-5 position-absolute bottom-0 row ">
                <form th:action="@{/user/__${user.id}__/msg}" method="POST">
                    <input type="text" id="message" placeholder="escribe a este usuario" />
                    <button id="sendmsg" class="btn btn-secondary" type="submit">Enviar</button>
                </form>
            </div>
            -->
        </div>
    </main>

    <th:block th:replace="fragments/footer.html :: footer" />
    <script>
        // envio de mensajes con AJAX
        let b = document.getElementById("sendmsg");
        b.onclick = (e) => {
            e.preventDefault();
            go(b.parentNode.action, 'POST', {
                    message: document.getElementById("message").value
                })
                .then(d => console.log("happy", d))
                .catch(e => console.log("sad", e))
        }
    </script>
    <script>
        window.onload = () => {
            const myInput = document.getElementById('passwordconfirm');
            myInput.onpaste = e => e.preventDefault();
        }
    </script>
</body>

</html>